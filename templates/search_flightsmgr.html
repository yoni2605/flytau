<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FLYTAU - ניהול טיסות</title>
  <link rel="stylesheet" type="text/css" href="/static/style.css">
</head>

<body>
  <main class="home">

    <section class="brand">
      <img class="logo" src="/static/logo.png" alt="FLYTAU Logo">
    </section>

    <section class="card" aria-label="ניהול טיסות">
      <h3 class="title">שלום, {{ session['namemgr'] }}</h3>

      <nav class="admin-menu">
        <a href="/homemgr/flights" class="admin-link active">חיפוש בלוח טיסות</a>
        <a href="/homemgr/addemployee" class="admin-link">הוספת אנשי צוות</a>
        <a href="/homemgr/addaircraft" class="admin-link">הוספת מטוס</a>
        <a href="/homemgr/addflight" class="admin-link">הוספת טיסות</a>
        <a href="/admin/reports" class="admin-link">סטטיסטיקות ודוחות</a>
      </nav>
              {% if error %}
          <div class="error-message">
              {{error}}
          </div>
          {% endif %}
              {% if good %}
        <div class="success-message">
            {{ good }}
        </div>
            {% endif %}

      <form class="form filters" method="get" action="/homemgr/flights">

        <div class="f-date">
          <label class="label">תאריך</label>
          <input class="input" type="date" min="{{ today }}" name="date" value="{{ request.args.get('filtered_date','') }}">
        </div>

        <div class="f-origin">
          <label class="label">מקור</label>
          <select class="input" name="origin">
            <option value="">כל המקורות</option>
            {% for o in origins %}
              <option value="{{ o }}" {% if request.args.get('origin','') == o %}selected{% endif %}>
                {{ o }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="f-dest">
          <label class="label">יעד</label>
          <select class="input" name="destination">
            <option value="">כל היעדים</option>
            {% for d in dests %}
              <option value="{{ d }}" {% if request.args.get('destination','') == d %}selected{% endif %}>
                {{ d }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="f-status">
          <label class="label">סטטוס טיסה</label>
          <select class="input" name="status">
            <option value="" {% if request.args.get('status','') == '' %}selected{% endif %}>כל הסטטוסים</option>
            <option value="Scheduled" {% if request.args.get('status') == 'Scheduled' %}selected{% endif %}>מתוכננת</option>
            <option value="Full" {% if request.args.get('status') == 'Full' %}selected{% endif %}>תפוסה מלאה</option>
            <option value="Completed" {% if request.args.get('status') == 'Completed' %}selected{% endif %}>התקיימה</option>
            <option value="Cancelled" {% if request.args.get('status') == 'Cancelled' %}selected{% endif %}>בוטלה</option>
          </select>
        </div>

        <div class="filters-actions">
          <a class="btn btn-secondary filter-action" href="/homemgr/flights">נקה</a>
          <button class="btn btn-primary filter-action" type="submit">סנן</button>
        </div>

      </form>

      <div style="margin-top:20px; overflow-x:auto;">
        <table style="width:100%; border-collapse:collapse; font-size:14px;">
          <thead>
            <tr style="background:#f7fbff;">
              <th style="padding:8px; border:1px solid var(--border);">מטוס</th>
              <th style="padding:8px; border:1px solid var(--border);">מקור</th>
              <th style="padding:8px; border:1px solid var(--border);">יעד</th>
              <th style="padding:8px; border:1px solid var(--border);">תאריך המראה</th>
              <th style="padding:8px; border:1px solid var(--border);">שעת המראה</th>
              <th style="padding:8px; border:1px solid var(--border);">תאריך נחיתה</th>
              <th style="padding:8px; border:1px solid var(--border);">שעת נחיתה</th>
              <th style="padding:8px; border:1px solid var(--border);">Economy</th>
              <th style="padding:8px; border:1px solid var(--border);">Business</th>
              <th style="padding:8px; border:1px solid var(--border);">סטטוס</th>
              <th style="padding:8px; border:1px solid var(--border);">פעולות</th>
            </tr>
          </thead>

          <tbody>
            {% for f in flights %}
              <tr>
                <td style="padding:8px; border:1px solid var(--border); text-align:center;">{{ f[0] }}</td>
                <td style="padding:8px; border:1px solid var(--border);">{{ f[3] }}</td>
                <td style="padding:8px; border:1px solid var(--border);">{{ f[4] }}</td>
                <td style="padding:8px; border:1px solid var(--border); text-align:center;">{{ f[1] }}</td>
                <td style="padding:8px; border:1px solid var(--border); text-align:center;">{{ f[2] }}</td>
                <td style="padding:8px; border:1px solid var(--border); text-align:center;">{{ f[5] }}</td>
                <td style="padding:8px; border:1px solid var(--border); text-align:center;">{{ f[6] }}</td>
                <td style="padding:8px; border:1px solid var(--border); text-align:center;">{{ f[7] }}</td>
                <td style="padding:8px; border:1px solid var(--border); text-align:center;">
                  {% if f[8] is not none %}{{ f[8] }}{% else %}—{% endif %}
                </td>
                <td style="padding:8px; border:1px solid var(--border); text-align:center;">{{ f[9] }}</td>
                  <td style="padding:8px; border:1px solid var(--border); text-align:center; white-space:nowrap;">
                    {% if f[9] != 'Cancelled' %}
                    <form method="post" action="/homemgr/cancelflight" style="display:inline;">
                      <input type="hidden" name="aircraft" value="{{ f[0] }}">
                      <input type="hidden" name="departure_date" value="{{ f[1] }}">
                      <input type="hidden" name="departure_time" value="{{ f[2] }}">
                      <input type="hidden" name="origin" value="{{ f[3] }}">
                      <input type="hidden" name="destination" value="{{ f[4] }}">
                      <button type="submit" class="btn btn-cancel">בטל</button>
                    </form>
                    {% else %}
                      בוטלה
                    {% endif %}
                  </td>

              </tr>
            {% else %}
              <tr>
                <td colspan="11" style="padding:12px; text-align:center; color:var(--muted);">
                  לא נמצאו טיסות
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </section>

    <div class="home-actions">
      <a href="/logout" class="btn btn-secondary">התנתק מהמערכת</a>
    </div>

  </main>
</body>
</html>
